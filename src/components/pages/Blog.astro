---
import Container from "../Container.astro";
---

<main class="content">
  <Container variant="static" class="flowchart-container">
    <h1 class="flowchart-header">Personal and Professional Goals 2025 - 2035</h1>
    <p class="flowchart-description">
      these be where my goals at, if i dont achieve them, i die (in a professional way)<br>Click on the nodes to highlight their path :]
    </p>

    <div class="flowchart">
      {Array.from({ length: 11 }, (_, i) => {
        const year = 2025 + i;
        const pct = i / 10;
        return (
          <>
            <div class="timeline-year" style={`top: calc(${pct} * (100% - 250px) + 135px);`}>
              {year}
            </div>
            <div class="timeline-line" style={`top: calc(${pct} * (100% - 250px) + 135px);`}></div>
          </>
        );
      })}

      <!-- Nodes -->
      <div class="node" id="node1" style="top: 45px;">Life Goals</div>
      <div class="node" id="node2" style="top: 100px;">Storyboard / Animation</div>
      <div class="node" id="node3" style="top: 100px;">Side Hustles</div>
      <div class="node" id="node4" style="top: 190px;">Study Film Language<br>and Shot Composition</div>
      <div class="node" id="node5" style="top: 190px;">Practice more Principles<br>of Animation</div>
      <div class="node" id="node6" style="top: 190px;">Keep doing art<br>commissions</div>
      <div class="node" id="node7" style="top: 500px;">Land a job doing<br>Clean Up Animation</div>
      <div class="node" id="node8" style="top: 500px;">Land a job as a <br>Storyboard Artist</div>
      <div class="node" id="node9" style="top: 500px;">Become a<br>Graphic Designer</div>
      <div class="node" id="node10" style="top: 396px;">Make a Short Film</div>
      <div class="node" id="node11" style="top: 396px;">Work as a Digital Artist<br>for a Company's<br>Social Media</div>
      <div class="node" id="node12" style="top: 710px;">Open a Patreon<br>or KoFi account</div>
      <div class="node" id="node13" style="top: 815px;">Collaborate with<br>other Indie Animators</div>
      <div class="node" id="node14" style="top: 605px;">Most likely work there for<br>a couple years</div>
      <div class="node" id="node15" style="top: 920px;">Join an Indie Animation Studio</div>
      <div class="node" id="node16" style="top: 1235px;">Become an part time<br>Animation / Storyboard Instructor</div>
      <div class="node" id="node17" style="top: 296px;">Learn more about<br>Color Scripting</div>
      <div class="node" id="node18" style="top: 1130px;">Move on to<br>Animation Studios<br>abroad</div>
      <div class="node" id="node19" style="top: 1130px;">Pitch my story<br>idea maybe (?????)</div>

      <!-- Lines -->
      {Array.from({ length: 23 }, (_, i) => <div class="line" id={`line${i+1}`}></div>)}
    </div>
	
	    <section class="card">
      <h2>Goal Framework</h2>
      <div class="accordion">
	  
	  <!-- S -->
        <div class="accordion-item">
          <button class="accordion-header">
            SMART Framework
            <span class="arrow">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path fill="currentColor" d="M7 10l5 5 5-5H7z"/>
              </svg>
            </span>
          </button>
          <div class="accordion-body">

            <h3>Specifics</h3>

			<p>uh</p>

            <h3>Measurable</h3>

			<p>uhh</p>

            <h3>Achievable</h3>

			<p>uhhh</p>

            <h3>Relevant</h3>

			<p>uhhhh</p>
			
            <h3>Time-Bound</h3>

			<p>uhhhhh</p>
			
          </div>
        </div>
		
      </div>
    </section>

	<section class="card">
      <h2>Other Stuff</h2>
      
      <ul>
      <li>er
      <li>er
      <li>er
      <li>er
      </ul>
		
      </div>
    </section>
  </Container>
</main>

<script>
const lines = [
  { line: line1, from: 'node1', to: 'node2' },
  { line: line2, from: 'node1', to: 'node3' },
  { line: line3, from: 'node2', to: 'node4' },
  { line: line4, from: 'node2', to: 'node5' },
  { line: line6, from: 'node4', to: 'node17' },
  { line: line22, from: 'node5', to: 'node17' },
  { line: line5, from: 'node3', to: 'node6' },
  { line: line7, from: 'node17', to: 'node10' },
  { line: line8, from: 'node6', to: 'node11' },
  { line: line9, from: 'node10', to: 'node8' },
  { line: line10, from: 'node10', to: 'node7' },
  { line: line11, from: 'node11', to: 'node9' },
  { line: line12, from: 'node9', to: 'node12' },
  { line: line13, from: 'node12', to: 'node13' },
  { line: line14, from: 'node8', to: 'node14' },
  { line: line15, from: 'node7', to: 'node14' },
  { line: line16, from: 'node13', to: 'node15' },
  { line: line17, from: 'node11', to: 'node9' },
  { line: line18, from: 'node14', to: 'node18' },
  { line: line19, from: 'node18', to: 'node16' },
  { line: line20, from: 'node15', to: 'node19' },
  { line: line21, from: 'node19', to: 'node16' },
];

// Build parent & child maps
const parents = {}, children = {};
lines.forEach(l => {
  if (!parents[l.to]) parents[l.to] = [];
  parents[l.to].push(l);
  if (!children[l.from]) children[l.from] = [];
  children[l.from].push(l);
});

function autoSpaceNodes() {
  const nodes = Array.from(document.querySelectorAll('.node'));
  const flowchart = document.querySelector('.flowchart');
  const chartWidth = flowchart.clientWidth;

  const grouped = {};
  nodes.forEach(node => {
    const y = node.style.top;
    if (!grouped[y]) grouped[y] = [];
    grouped[y].push(node);
  });

  Object.values(grouped).forEach(group => {
    const count = group.length;
    const spacing = chartWidth / (count + 1);
    group.forEach((node, i) => {
      node.style.left = `${spacing * (i + 1)}px`;
    });
  });
}

function updateLines() {
  lines.forEach(l => {
    const fromNode = document.getElementById(l.from);
    const toNode = document.getElementById(l.to);
    const x1 = fromNode.offsetLeft;
    const y1 = fromNode.offsetTop;
    const x2 = toNode.offsetLeft;
    const y2 = toNode.offsetTop;

    const length = Math.hypot(x2 - x1, y2 - y1);
    const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;

    l.line.style.width = `${length}px`;
    l.line.style.top = `${y1}px`;
    l.line.style.left = `${x1}px`;
    l.line.style.transform = `rotate(${angle}deg)`;
  });
}

function highlightAncestors(nodeId, activeNodes = new Set()) {
  if (!parents[nodeId]) return activeNodes;
  parents[nodeId].forEach(p => {
    p.line.classList.add("active");
    activeNodes.add(p.from);
    highlightAncestors(p.from, activeNodes);
  });
  return activeNodes;
}

function clearHighlights() {
  document.querySelectorAll('.node').forEach(n => {
    n.style.opacity = '1';
    n.classList.remove('selected'); // <-- remove selected class
  });
  document.querySelectorAll('.line').forEach(l => {
    l.style.opacity = '1';
    l.classList.remove("active");
    l.classList.remove("gradient");
  });
}

let activeNode = null;
document.querySelectorAll('.node').forEach(node => {
  node.addEventListener('click', e => {
    e.stopPropagation();
    const alreadyActive = activeNode === node;
    clearHighlights();
    if (alreadyActive) { activeNode = null; return; }
    activeNode = node;
    node.classList.add('selected');
    const activeNodes = new Set([node.id]);
    highlightAncestors(node.id, activeNodes);
    if (children[node.id]) children[node.id].forEach(l => l.line.classList.add("gradient"));
    document.querySelectorAll('.node').forEach(n => n.style.opacity = activeNodes.has(n.id) ? '1' : '0.2');
    document.querySelectorAll('.line').forEach(l => l.style.opacity = (l.classList.contains("active") || l.classList.contains("gradient")) ? '1' : '0.2');
  });
});



// Click outside nodes to clear highlights
document.addEventListener('click', () => {
  if (activeNode) {
    activeNode = null;
    clearHighlights();
  }
});

window.addEventListener('load', () => {
  autoSpaceNodes();
  updateLines();
});
window.addEventListener('resize', () => {
  autoSpaceNodes();
  updateLines();
});

</script>

<style>
main.content {
  flex: 1;
  margin-left: 260px;
  padding: 2rem;
  color: var(--text-dark);
}

.flowchart-container {
  position: relative;
}

.flowchart-header {
  font-size: 1.8rem;
  color: var(--color-1);
  margin-bottom: 0.5rem;
}

.flowchart-description {
  font-size: 1rem;
  color: var(--text-main);
  margin-bottom: 1.5rem;
}

.flowchart {
  position: relative;
  width: 100%;
  max-width: 900px;
  height: 1300px;
  margin: 0rem auto;
  background: var(--container);
  padding: 100px;
  box-sizing: border-box;
  border: 2px solid var(--color-5);
  border-radius: 1.2rem;
}

.timeline-year {
  position: absolute;
  left: 0;
  font-size: 12px;
  color: var(--color-2);
  width: 80px;
  text-align: right;
  transform: translateY(-50%);
  z-index: 1;
}

.timeline-line {
  position: absolute;
  left: 100px;
  right: 100px;
  height: 1px;
  background: var(--color-5);
  z-index: 0;
}

.node {
  position: absolute;
  transform: translate(-50%, -50%);
  padding: 6px 14px;
  font-size: 0.85rem;
  background: var(--color-2);
  color: var(--text-light);
  border-radius: 6px;
  text-align: center;
  z-index: 2;
  white-space: nowrap;
  transition: opacity 0.2s ease, transform 0.2s ease;
}

.node.selected {
  border: 4px solid var(--color-4);
  z-index: 3;
}

.line {
  position: absolute;
  background: var(--line-dormant);
  height: 2px;
  transform-origin: 0 0;
  z-index: 1;
  transition: opacity 0.2s ease, background 0.2s ease;
}

.line.active {
  background: var(--line-highlight);
}

.line.gradient {
  background: linear-gradient(to right, var(--line-highlight), transparent);
}

 .card {
    margin-top: 1.5rem;
    padding: 1.25rem;
    border-radius: 1rem;
    background: var(--color-6);
    border: 2px solid var(--color-5);
  }

  .accordion { display: flex; flex-direction: column; gap: 0.5rem; }

  .accordion-header {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--color-5);
    border: 2px solid var(--color-5);
    border-radius: 0.75rem;
    padding: 0.6rem 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.25s ease;
    border-bottom: none; /* hide bottom line when closed */
  }

  .accordion-header.active {
    background: var(--color-3);
    color: var(--text-main);
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
    border-bottom: none; /* hide bottom line when closed */
  }

  .arrow {
    display: flex;
    align-items: center; /* vertical center */
    transition: transform 0.25s ease;
  }

  .arrow svg {
    width: 20px;
    height: 20px;
  }

  .accordion-header.active .arrow {
    transform: rotate(180deg);
  }

	.accordion-body {
	  overflow: hidden;
	  height: 0;
	  transition: height 0.35s ease, border 0.25s ease, opacity 0.3s ease;
	  border: 2px solid var(--color-5); /* show border when open */
	  border-bottom: none;
	  border-bottom-left-radius: 0.75rem;
	  border-bottom-right-radius: 0.75rem;
	  background: var(--color-6);
	  padding: 0 1rem;
	  opacity: 0;
	}

	.accordion-header.active + .accordion-body {
	  border: 2px solid var(--color-5); /* show border when open */
	  border-top: none;
	  opacity: 1;
	}

  .accordion-body ul { padding-left: 1.25rem; list-style-type: disc; margin: 0.5rem 0; }

  @media (max-width: 768px) {
    main.content { margin-left: 0; padding: 1rem; }
  }

.accordion-header {
  font-family: "Fredoka", sans-serif;
  font-size: 1.2rem;
  color: var(--color-3);
}

  h1 { font-size: 1.8rem; color: var(--color-1); margin-bottom: 1rem; }
  h2 { font-size: 1.3rem; color: var(--color-2); margin-bottom: 0.5rem; }
  h2 { font-size: 1.3rem; color: var(--color-2); margin-top: -0.5rem; }
  h3 { font-size: 1.3rem; color: var(--color-2); margin-bottom: 0.5rem; }
	
	h3 {
  position: relative;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-weight: 600;
}
	
	h3::after {
  content: "";
  flex-grow: 1;
  height: 2px;
  background-color: var(--color-5); /* or any color you want */
  opacity: 0.5; /* optional, for a softer look */
}

</style>
